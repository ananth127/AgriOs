# ğŸ—ï¸ Logging System Architecture

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER'S BROWSER                          â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   AGRI-OS APPLICATION                     â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ â”‚
â”‚  â”‚  â”‚   React     â”‚  â”‚   Next.js   â”‚  â”‚    User     â”‚     â”‚ â”‚
â”‚  â”‚  â”‚ Components  â”‚  â”‚    Pages    â”‚  â”‚  Interface  â”‚     â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â”‚ â”‚
â”‚  â”‚         â”‚                â”‚                â”‚             â”‚ â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚ â”‚
â”‚  â”‚                         â”‚                                â”‚ â”‚
â”‚  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚ â”‚
â”‚  â”‚         â”‚    ERROR BOUNDARY LAYER       â”‚               â”‚ â”‚
â”‚  â”‚         â”‚  (Catches component errors)   â”‚               â”‚ â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚ â”‚
â”‚  â”‚                         â”‚                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              LOGGING SYSTEM (CORE)                       â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚ â”‚
â”‚  â”‚  â”‚   Console        â”‚  â”‚    Network       â”‚            â”‚ â”‚
â”‚  â”‚  â”‚  Interceptor     â”‚  â”‚   Interceptor    â”‚            â”‚ â”‚
â”‚  â”‚  â”‚  (console.X)     â”‚  â”‚   (fetch API)    â”‚            â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ â”‚
â”‚  â”‚           â”‚                     â”‚                       â”‚ â”‚
â”‚  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚ â”‚
â”‚  â”‚                    â”‚                                    â”‚ â”‚
â”‚  â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚ â”‚
â”‚  â”‚        â”‚   CENTRAL LOGGER     â”‚                        â”‚ â”‚
â”‚  â”‚        â”‚                      â”‚                        â”‚ â”‚
â”‚  â”‚        â”‚  - Filters           â”‚                        â”‚ â”‚
â”‚  â”‚        â”‚  - Sanitizes         â”‚                        â”‚ â”‚
â”‚  â”‚        â”‚  - Enriches Context  â”‚                        â”‚ â”‚
â”‚  â”‚        â”‚  - Batches           â”‚                        â”‚ â”‚
â”‚  â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚ â”‚
â”‚  â”‚                    â”‚                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                       â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚            STORAGE LAYER                               â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚  â”‚
â”‚  â”‚  â”‚   IndexedDB      â”‚     â”‚   Memory Queue   â”‚        â”‚  â”‚
â”‚  â”‚  â”‚  (Persistent)    â”‚     â”‚   (Temporary)    â”‚        â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”‚
â”‚  â”‚           â”‚                        â”‚                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                        â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                        â”‚
               â”‚  Batch Upload          â”‚  Immediate Upload
               â”‚  (Every 30s)           â”‚  (On Errors)
               â”‚                        â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ HTTPS POST
                        â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                           â”‚
          â”‚    BACKEND SERVER         â”‚
          â”‚   (FastAPI)               â”‚
          â”‚                           â”‚
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
          â”‚  â”‚  /api/v1/logs    â”‚    â”‚
          â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
          â”‚  â”‚  â”‚  Receive   â”‚  â”‚    â”‚
          â”‚  â”‚  â”‚  Validate  â”‚  â”‚    â”‚
          â”‚  â”‚  â”‚   Store    â”‚  â”‚    â”‚
          â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
          â”‚          â”‚               â”‚
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
          â”‚  â”‚  File Storage    â”‚   â”‚
          â”‚  â”‚                  â”‚   â”‚
          â”‚  â”‚  logs/           â”‚   â”‚
          â”‚  â”‚  â””â”€ frontend/    â”‚   â”‚
          â”‚  â”‚     â”œâ”€ frontend- â”‚   â”‚
          â”‚  â”‚     â”‚  2026-02-06â”‚   â”‚
          â”‚  â”‚     â”‚  .jsonl    â”‚   â”‚
          â”‚  â”‚     â””â”€ errors-   â”‚   â”‚
          â”‚  â”‚        2026-02-06â”‚   â”‚
          â”‚  â”‚        .jsonl    â”‚   â”‚
          â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
          â”‚                          â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ Analysis
                     â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                     â”‚
          â”‚   AI DEBUGGING      â”‚
          â”‚   ASSISTANT         â”‚
          â”‚                     â”‚
          â”‚  - Pattern Analysis â”‚
          â”‚  - Root Cause Diag  â”‚
          â”‚  - Fix Suggestions  â”‚
          â”‚                     â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow

### 1. **Error Occurs**
```
User Action â†’ Error â†’ Console/Component/Network
```

### 2. **Capture**
```
Interceptor â†’ Logger â†’ Sanitize â†’ Enrich Context
```

### 3. **Local Storage**
```
Logger â†’ IndexedDB (Persistent) + Memory Queue (Fast)
```

### 4. **Upload**
```
Batch Timer â†’ Collect Logs â†’ POST /api/v1/logs â†’ Backend
```

### 5. **Backend Processing**
```
Receive â†’ Validate â†’ Write to JSONL Files
```

### 6. **Analysis**
```
Log Files â†’ AI Assistant â†’ Root Cause + Fixes
```

## Component Details

### Frontend Logger
- **Purpose**: Capture and process all logs
- **Key Features**:
  - Console interception
  - Network monitoring
  - Error boundaries
  - Batch uploads
  - Offline support

### Storage Layer
- **IndexedDB**: Persistent, survives page reloads
- **Memory Queue**: Fast, temporary buffer
- **Max Capacity**: 1000 logs (configurable)
- **Auto-Cleanup**: Removes old logs

### Network Interceptor
- **Target**: `window.fetch`
- **Captures**: 
  - Request: method, URL, headers, body
  - Response: status, body, duration
  - Errors: Full error details

### Error Boundary
- **Scope**: React component tree
- **Captures**: 
  - Component errors
  - Error info
  - Component stack

### Backend API
- **Endpoints**:
  - `POST /api/v1/logs` - Receive logs
  - `GET /api/v1/logs/stats` - Get statistics
  - `GET /api/v1/logs/recent` - Query logs
  - `DELETE /api/v1/logs/clear` - Cleanup

### File Storage
- **Format**: JSONL (JSON Lines)
- **Organization**: One file per day
- **Separate Files**: Errors get their own file
- **Location**: `backend/logs/frontend/`

## Security & Privacy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Raw Log Data â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Sanitization   â”‚
â”‚  ============   â”‚
â”‚  - passwords    â”‚
â”‚  - tokens       â”‚
â”‚  - API keys     â”‚
â”‚  - credit cards â”‚
â”‚  - PII          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Clean Log Data  â”‚
â”‚  [REDACTED]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Performance Optimizations

### Batching
```
Logs â†’ Queue â†’ Wait 30s â†’ Batch Upload â†’ Server
  â”‚
  â””â”€ On Error â†’ Immediate Upload
```

### Storage Limits
```
Max Logs in Memory: 100
Max Logs in Storage: 1000
Auto-Cleanup: When limit exceeded
```

### Non-Blocking
```
All operations are async/await
- Storage writes: Non-blocking
- Network uploads: Non-blocking
- Log processing: Non-blocking
```

## Log Structure

```
LogEntry
â”œâ”€â”€ id (unique)
â”œâ”€â”€ level (DEBUG|INFO|WARN|ERROR|FATAL)
â”œâ”€â”€ category (SYSTEM|NETWORK|...)
â”œâ”€â”€ message (string)
â”œâ”€â”€ context
â”‚   â”œâ”€â”€ userId
â”‚   â”œâ”€â”€ sessionId
â”‚   â”œâ”€â”€ url
â”‚   â”œâ”€â”€ device info
â”‚   â””â”€â”€ timestamp
â”œâ”€â”€ metadata (any additional data)
â””â”€â”€ specialized logs
    â”œâ”€â”€ networkLog (for API calls)
    â”œâ”€â”€ errorLog (for errors)
    â”œâ”€â”€ userActionLog (for actions)
    â””â”€â”€ performanceLog (for metrics)
```

## Integration Points

### 1. Application Entry
```typescript
// layout.tsx
<ErrorBoundary>
  <LoggerProvider>
    <App />
  </LoggerProvider>
</ErrorBoundary>
```

### 2. Network Layer
```typescript
// Automatic via fetch interception
fetch('/api/endpoint') // â† Automatically logged
```

### 3. Manual Logging
```typescript
// Anywhere in code
logger.error('message', category, error, data);
```

### 4. Backend Integration
```python
# main.py
app.include_router(logging_router, prefix="/api/v1")
```

## Monitoring Flow

```
Developer
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Log Viewer  â”‚ â”€â”€â”€â–¶ â”‚  Browser     â”‚ â”€â”€â”€â–¶ â”‚  IndexedDB  â”‚
â”‚ Component   â”‚      â”‚  Console     â”‚      â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend API â”‚ â”€â”€â”€â–¶ â”‚  Log Files   â”‚
â”‚ Endpoints   â”‚      â”‚  (.jsonl)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI Analysis â”‚
â”‚ & Debugging â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Architecture designed for:**
- âœ… Zero configuration overhead
- âœ… Automatic capture
- âœ… Privacy compliance
- âœ… Performance efficiency
- âœ… AI-powered debugging
- âœ… Developer experience
